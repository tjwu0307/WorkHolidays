<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œä¸Šç­ä¼‘å‡ç´€éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">å·¥ä½œä¸Šç­ä¼‘å‡ç´€éŒ„</h1>
            <p class="text-gray-600">ç®¡ç†æ‚¨çš„å·¥ä½œä¼‘å‡èˆ‡åœ‹å®šå‡æ—¥</p>
        </div>

        <!-- å–®æ¬„ç·Šæ¹Šä½ˆå±€ -->
        <div class="max-w-6xl mx-auto space-y-4">
                <!-- å“¡å·¥åŸºæœ¬è³‡è¨Š -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">1</span>
                        å“¡å·¥åŸºæœ¬è³‡è¨Š
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å§“å</label>
                            <input type="text" id="employeeName" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="è«‹è¼¸å…¥å§“å">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å¹´åº¦èµ·å§‹æ—¥æœŸ</label>
                            <input type="date" id="startDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å¹´åº¦çµæŸæ—¥æœŸ</label>
                            <input type="date" id="endDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 bg-gray-50" readonly>
                        </div>
                    </div>
                </div>

                <!-- ç‰¹ä¼‘çµ±è¨ˆ -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <span class="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">ğŸ“Š</span>
                        ç‰¹ä¼‘çµ±è¨ˆ
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                        <div class="bg-blue-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-blue-600">10</div>
                            <div class="text-xs text-gray-600">å¹´åº¦ç¸½å¤©æ•¸</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-green-600">80</div>
                            <div class="text-xs text-gray-600">å¹´åº¦ç¸½å°æ™‚</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-orange-600" id="usedDays">0</div>
                            <div class="text-xs text-gray-600">å·²ä½¿ç”¨å¤©æ•¸</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-purple-600" id="remainingDays">10</div>
                            <div class="text-xs text-gray-600">å‰©é¤˜å¤©æ•¸</div>
                        </div>
                        <div class="bg-indigo-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-indigo-600" id="remainingHours">80</div>
                            <div class="text-xs text-gray-600">å‰©é¤˜å°æ™‚</div>
                        </div>
                    </div>
                </div>

                <!-- å·¥ä½œæ—¥å€’æ•¸è¨ˆç®— -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <span class="bg-yellow-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">ğŸ“…</span>
                        å·¥ä½œæ—¥å€’æ•¸è¨ˆç®—
                    </h2>
                    <div class="space-y-3">
                        <div class="bg-yellow-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-yellow-600" id="workingDaysCount">è¨ˆç®—ä¸­...</div>
                            <div class="text-xs text-gray-600">è·é›¢æ˜¥ç¯€å‡æœŸ2026/2/14(é€±å…­)å‰©é¤˜å·¥ä½œæ—¥</div>
                        </div>
                        <div class="max-h-48 overflow-y-auto">
                            <div id="holidayList">
                                <!-- åœ‹å®šå‡æ—¥å’Œç‰¹ä¼‘åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç‰¹ä¼‘ç´€éŒ„åˆ—è¡¨ -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <span class="bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">ğŸ“‹</span>
                        ç‰¹ä¼‘ç´€éŒ„
                    </h2>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">ç”³è«‹æ—¥æœŸ</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">ä¼‘å‡æœŸé–“</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">å¤©æ•¸</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">å°æ™‚æ•¸</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">äº‹ç”±</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">å‚™è¨»</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-700">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="leaveRecords" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-2 py-4 text-center text-gray-500 text-sm">
                                        å°šç„¡ç‰¹ä¼‘ç´€éŒ„ï¼Œè«‹æ–°å¢ç¬¬ä¸€ç­†ç”³è«‹
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            <!-- æ–°å¢ç‰¹ä¼‘ç”³è«‹ -->
            <div class="bg-white rounded-lg shadow-lg p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <span class="bg-indigo-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2" id="formIcon">+</span>
                    <span id="formTitle">æ–°å¢ç‰¹ä¼‘ç”³è«‹</span>
                </h2>
                <form id="leaveForm" class="space-y-3">
                    <!-- ç¬¬1åˆ—ï¼šç”³è«‹æ—¥æœŸ/äº‹ç”±/å‚™è¨» -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">ç”³è«‹æ—¥æœŸ</label>
                            <input type="date" id="applicationDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">äº‹ç”±</label>
                            <input type="text" id="reason" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥ä¼‘å‡äº‹ç”±" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å‚™è¨»</label>
                            <input type="text" id="notes" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" placeholder="å…¶ä»–å‚™è¨»äº‹é …ï¼ˆé¸å¡«ï¼‰">
                        </div>
                    </div>
                    
                    <!-- ç¬¬2åˆ—ï¼šé–‹å§‹æ—¥æœŸ/é–‹å§‹æ™‚é–“/çµæŸæ—¥æœŸ/çµæŸæ™‚é–“ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">é–‹å§‹æ—¥æœŸ</label>
                            <input type="date" id="leaveStartDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">é–‹å§‹æ™‚é–“</label>
                            <input type="time" id="leaveStartTime" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" value="09:00" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">çµæŸæ—¥æœŸ</label>
                            <input type="date" id="leaveEndDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">çµæŸæ™‚é–“</label>
                            <input type="time" id="leaveEndTime" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" value="18:00" required>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-indigo-600 text-white py-2 px-3 text-sm rounded hover:bg-indigo-700 transition duration-200 font-medium" id="submitBtn">
                            æ–°å¢ç‰¹ä¼‘ç”³è«‹
                        </button>
                        <button type="button" onclick="cancelEdit()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-3 text-sm rounded hover:bg-gray-50 transition duration-200 font-medium" id="cancelBtn" style="display: none;">
                            å–æ¶ˆ
                        </button>
                    </div>
                </form>
            </div>

            <!-- æ–°å¢åœ‹å®šå‡æ—¥ -->
            <div class="bg-white rounded-lg shadow-lg p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <span class="bg-purple-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2">ğŸ‰</span>
                    æ–°å¢åœ‹å®šå‡æ—¥
                </h2>
                <form id="holidayForm">
                    <!-- åç¨±/æ—¥æœŸ ä¸¦æ’ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å‡æ—¥åç¨±</label>
                            <input type="text" id="holidayName" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500" placeholder="ä¾‹ï¼šæ˜¥ç¯€" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">å‡æ—¥æ—¥æœŸ</label>
                            <input type="date" id="holidayDate" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 text-white py-2 px-3 text-sm rounded hover:bg-purple-700 transition duration-200 font-medium">
                        æ–°å¢åœ‹å®šå‡æ—¥
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let leaveRecords = JSON.parse(localStorage.getItem('leaveRecords')) || [];
        let holidays = JSON.parse(localStorage.getItem('holidays')) || [];
        let recordIdCounter = Math.max(...leaveRecords.map(r => r.id), 0) + 1;
        let holidayIdCounter = Math.max(...holidays.map(h => h.id), 0) + 1;
        let editingRecordId = null;

        // è¨ˆç®—å¹´åº¦çµæŸæ—¥æœŸï¼ˆèµ·å§‹æ—¥æœŸ+1å¹´-1å¤©ï¼‰
        function calculateEndDate(startDateValue) {
            if (!startDateValue) return '';
            
            const startDate = new Date(startDateValue);
            const endDate = new Date(startDate);
            endDate.setFullYear(startDate.getFullYear() + 1);
            endDate.setDate(endDate.getDate() - 1);
            
            return endDate.toISOString().split('T')[0];
        }

        // è¨­å®šé è¨­æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const currentYear = today.getFullYear();
            
            // è¨­å®šå¹´åº¦èµ·å§‹æ—¥æœŸ
            const startDateInput = document.getElementById('startDate');
            startDateInput.value = `${currentYear}-01-01`;
            
            // è‡ªå‹•è¨ˆç®—ä¸¦è¨­å®šå¹´åº¦çµæŸæ—¥æœŸ
            document.getElementById('endDate').value = calculateEndDate(startDateInput.value);
            
            // è¨­å®šç”³è«‹æ—¥æœŸç‚ºä»Šå¤©
            document.getElementById('applicationDate').value = today.toISOString().split('T')[0];
            
            // ç›£è½èµ·å§‹æ—¥æœŸè®Šæ›´
            startDateInput.addEventListener('change', function() {
                document.getElementById('endDate').value = calculateEndDate(this.value);
            });

            // ç›£è½ä¼‘å‡é–‹å§‹æ—¥æœŸè®Šæ›´ï¼Œè‡ªå‹•è¨­å®šçµæŸæ—¥æœŸå’Œæ™‚é–“
            document.getElementById('leaveStartDate').addEventListener('change', function() {
                const startDate = this.value;
                if (startDate) {
                    document.getElementById('leaveEndDate').value = startDate;
                    document.getElementById('leaveEndTime').value = '18:00';
                }
            });

            // åˆå§‹åŒ–é è¨­çš„åœ‹å®šå‡æ—¥
            initializeDefaultHolidays();
            updateWorkingDaysCalculation();
        });

        // åˆå§‹åŒ–é è¨­åœ‹å®šå‡æ—¥
        function initializeDefaultHolidays() {
            // å¦‚æœå·²æœ‰å‡æ—¥è³‡æ–™ï¼Œå°±ä¸åˆå§‹åŒ–é è¨­å€¼
            if (holidays.length > 0) return;
            
            const defaultHolidays = [
                // 2025å¹´åœ‹å®šå‡æ—¥
                { name: 'å…ƒæ—¦', date: '2025-01-01' },
                { name: 'æ˜¥ç¯€', date: '2025-01-28' },
                { name: 'æ˜¥ç¯€', date: '2025-01-29' },
                { name: 'æ˜¥ç¯€', date: '2025-01-30' },
                { name: 'æ˜¥ç¯€', date: '2025-01-31' },
                { name: 'æ˜¥ç¯€', date: '2025-02-01' },
                { name: 'å’Œå¹³ç´€å¿µæ—¥', date: '2025-02-28' },
                { name: 'å…’ç«¥ç¯€', date: '2025-04-04' },
                { name: 'æ¸…æ˜ç¯€', date: '2025-04-05' },
                { name: 'å‹å‹•ç¯€', date: '2025-05-01' },
                { name: 'ç«¯åˆç¯€', date: '2025-05-31' },
                { name: 'æ•™å¸«ç¯€', date: '2025-09-28' },
                { name: 'ä¸­ç§‹ç¯€', date: '2025-10-06' },
                { name: 'åœ‹æ…¶æ—¥', date: '2025-10-10' },
                { name: 'å…‰å¾©ç¯€', date: '2025-10-24' },
                { name: 'è¡Œæ†²ç´€å¿µæ—¥', date: '2025-12-25' },
                // 2026å¹´åœ‹å®šå‡æ—¥
                { name: 'å…ƒæ—¦', date: '2026-01-01' },
                { name: 'æ˜¥ç¯€', date: '2026-02-14' },
                { name: 'æ˜¥ç¯€', date: '2026-02-15' },
                { name: 'æ˜¥ç¯€', date: '2026-02-16' },
                { name: 'æ˜¥ç¯€', date: '2026-02-17' },
                { name: 'æ˜¥ç¯€', date: '2026-02-18' }
            ];

            defaultHolidays.forEach(holiday => {
                holidays.push({
                    id: holidayIdCounter++,
                    name: holiday.name,
                    date: holiday.date
                });
            });
            
            // å„²å­˜åˆ° localStorage
            localStorage.setItem('holidays', JSON.stringify(holidays));
        }

        // è¨ˆç®—ä¼‘å‡å°æ™‚æ•¸ï¼ˆç²¾ç¢ºè¨ˆç®—æ™‚é–“å·®ï¼‰
        function calculateLeaveHours(startDate, startTime, endDate, endTime) {
            const start = new Date(`${startDate}T${startTime}`);
            const end = new Date(`${endDate}T${endTime}`);
            
            // è¨ˆç®—ç¸½å°æ™‚æ•¸
            const timeDiff = end.getTime() - start.getTime();
            const hours = timeDiff / (1000 * 3600);
            
            return Math.max(0, Math.round(hours * 100) / 100); // ä¿ç•™å…©ä½å°æ•¸
        }

        // è¨ˆç®—ä¼‘å‡å¤©æ•¸ï¼ˆå°æ™‚æ•¸é™¤ä»¥8ï¼‰
        function calculateLeaveDays(hours) {
            return Math.round((hours / 8) * 100) / 100; // ä¿ç•™å…©ä½å°æ•¸
        }

        // è¨ˆç®—å·¥ä½œæ—¥ï¼ˆæ’é™¤é€±æœ«ã€åœ‹å®šå‡æ—¥ã€ç‰¹ä¼‘ï¼‰
        function calculateWorkingDays() {
            const today = new Date();
            const springFestival = new Date('2026-02-14'); // 2026å¹´æ˜¥ç¯€æ—¥æœŸ
            
            let workingDays = 0;
            let currentDate = new Date(today);
            
            while (currentDate <= springFestival) {
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayOfWeek = currentDate.getDay();
                
                // æ’é™¤é€±æœ«
                if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                    // æª¢æŸ¥æ˜¯å¦ç‚ºåœ‹å®šå‡æ—¥
                    const isHoliday = holidays.some(holiday => holiday.date === dateStr);
                    // æª¢æŸ¥æ˜¯å¦ç‚ºç‰¹ä¼‘æ—¥
                    const isLeaveDay = leaveRecords.some(record => {
                        const startDate = new Date(record.startDate);
                        const endDate = new Date(record.endDate);
                        const checkDate = new Date(dateStr);
                        return checkDate >= startDate && checkDate <= endDate;
                    });
                    
                    if (!isHoliday && !isLeaveDay) {
                        workingDays++;
                    }
                }
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return workingDays;
        }

        // æ›´æ–°å·¥ä½œæ—¥è¨ˆç®—å’Œå‡æ—¥åˆ—è¡¨
        function updateWorkingDaysCalculation() {
            const workingDays = calculateWorkingDays();
            document.getElementById('workingDaysCount').textContent = workingDays;
            
            // æ›´æ–°å‡æ—¥åˆ—è¡¨
            const holidayList = document.getElementById('holidayList');
            const allDates = [];
            
            // æ·»åŠ åœ‹å®šå‡æ—¥
            holidays.forEach(holiday => {
                allDates.push({
                    date: holiday.date,
                    name: holiday.name,
                    type: 'holiday'
                });
            });
            
            // æ·»åŠ ç‰¹ä¼‘æ—¥
            leaveRecords.forEach(record => {
                const startDate = new Date(record.startDate);
                const endDate = new Date(record.endDate);
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    allDates.push({
                        date: currentDate.toISOString().split('T')[0],
                        name: record.reason,
                        type: 'leave'
                    });
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            });
            
            // æ’åºä¸¦é¡¯ç¤º
            allDates.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // åˆ†ç‚ºå…©æ¬„é¡¯ç¤º
            const holidayDates = allDates.filter(item => item.type === 'holiday');
            const leaveDates = allDates.filter(item => item.type === 'leave');
            
            function getWeekday(dateStr) {
                const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                const date = new Date(dateStr);
                return weekdays[date.getDay()];
            }
            
            holidayList.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-sm font-medium text-blue-600 mb-2">åœ‹å®šå‡æ—¥</h4>
                        <div class="space-y-1">
                            ${holidayDates.map(item => `
                                <div class="flex justify-between items-center p-2 rounded bg-blue-50">
                                    <span class="text-blue-600 font-medium text-sm">${item.name}</span>
                                    <span class="text-xs text-gray-500">${item.date} (${getWeekday(item.date)})</span>
                                </div>
                            `).join('')}
                            ${holidayDates.length === 0 ? '<div class="text-xs text-gray-400 p-2">ç„¡åœ‹å®šå‡æ—¥</div>' : ''}
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-red-600 mb-2">ç‰¹ä¼‘å‡æœŸ</h4>
                        <div class="space-y-1">
                            ${leaveDates.map(item => `
                                <div class="flex justify-between items-center p-2 rounded bg-red-50">
                                    <span class="text-red-600 font-medium text-sm">${item.name}</span>
                                    <span class="text-xs text-gray-500">${item.date} (${getWeekday(item.date)})</span>
                                </div>
                            `).join('')}
                            ${leaveDates.length === 0 ? '<div class="text-xs text-gray-400 p-2">ç„¡ç‰¹ä¼‘å‡æœŸ</div>' : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStatistics() {
            const totalUsedDays = leaveRecords.reduce((sum, record) => sum + record.days, 0);
            const totalUsedHours = leaveRecords.reduce((sum, record) => sum + record.hours, 0);
            const remainingDays = Math.max(0, 10 - totalUsedDays);
            const remainingHours = Math.max(0, 80 - totalUsedHours);

            document.getElementById('usedDays').textContent = totalUsedDays.toFixed(2);
            document.getElementById('remainingDays').textContent = remainingDays.toFixed(2);
            document.getElementById('remainingHours').textContent = remainingHours.toFixed(0);
            
            updateWorkingDaysCalculation();
        }

        // æ¸²æŸ“ç´€éŒ„è¡¨æ ¼
        function renderRecords() {
            const tbody = document.getElementById('leaveRecords');
            
            if (leaveRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                            å°šç„¡ç‰¹ä¼‘ç´€éŒ„ï¼Œè«‹æ–°å¢ç¬¬ä¸€ç­†ç”³è«‹
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = leaveRecords.map(record => `
                <tr class="hover:bg-gray-50">
                    <td class="px-2 py-2 text-xs text-gray-900">${record.applicationDate}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">
                        ${record.startDate} ${record.startTime}<br>
                        <span class="text-gray-500">è‡³</span><br>
                        ${record.endDate} ${record.endTime}
                    </td>
                    <td class="px-2 py-2 text-xs font-medium text-blue-600">${record.days}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${record.hours}h</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${record.reason}</td>
                    <td class="px-2 py-2 text-xs text-gray-500">${record.notes || '-'}</td>
                    <td class="px-2 py-2 text-xs">
                        <button onclick="editRecord(${record.id})" class="text-blue-600 hover:text-blue-800 font-medium mr-2 text-xs">
                            ä¿®æ”¹
                        </button>
                        <button onclick="deleteRecord(${record.id})" class="text-red-600 hover:text-red-800 font-medium text-xs">
                            åˆªé™¤
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ä¿®æ”¹ç´€éŒ„
        function editRecord(id) {
            const record = leaveRecords.find(r => r.id === id);
            if (!record) return;

            // å¡«å…¥è¡¨å–®
            document.getElementById('applicationDate').value = record.applicationDate;
            document.getElementById('leaveStartDate').value = record.startDate;
            document.getElementById('leaveStartTime').value = record.startTime;
            document.getElementById('leaveEndDate').value = record.endDate;
            document.getElementById('leaveEndTime').value = record.endTime;
            document.getElementById('reason').value = record.reason;
            document.getElementById('notes').value = record.notes || '';

            // æ›´æ–°UIç‹€æ…‹
            editingRecordId = id;
            document.getElementById('formTitle').textContent = 'ä¿®æ”¹ç‰¹ä¼‘ç”³è«‹';
            document.getElementById('formIcon').textContent = 'âœï¸';
            document.getElementById('submitBtn').textContent = 'æ›´æ–°ç‰¹ä¼‘ç”³è«‹';
            document.getElementById('cancelBtn').style.display = 'block';

            // æ»¾å‹•åˆ°è¡¨å–®
            document.getElementById('leaveForm').scrollIntoView({ behavior: 'smooth' });
        }

        // å–æ¶ˆä¿®æ”¹
        function cancelEdit() {
            editingRecordId = null;
            document.getElementById('formTitle').textContent = 'æ–°å¢ç‰¹ä¼‘ç”³è«‹';
            document.getElementById('formIcon').textContent = '+';
            document.getElementById('submitBtn').textContent = 'æ–°å¢ç‰¹ä¼‘ç”³è«‹';
            document.getElementById('cancelBtn').style.display = 'none';
            
            // é‡ç½®è¡¨å–®
            document.getElementById('leaveForm').reset();
            document.getElementById('applicationDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('leaveStartTime').value = '09:00';
            document.getElementById('leaveEndTime').value = '18:00';
        }

        // åˆªé™¤ç´€éŒ„
        function deleteRecord(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç‰¹ä¼‘ç´€éŒ„å—ï¼Ÿ')) {
                leaveRecords = leaveRecords.filter(record => record.id !== id);
                
                // å„²å­˜åˆ° localStorage
                localStorage.setItem('leaveRecords', JSON.stringify(leaveRecords));
                
                // å¦‚æœæ­£åœ¨ä¿®æ”¹é€™ç­†ç´€éŒ„ï¼Œå–æ¶ˆä¿®æ”¹ç‹€æ…‹
                if (editingRecordId === id) {
                    cancelEdit();
                }
                
                renderRecords();
                updateStatistics();
            }
        }

        // ç‰¹ä¼‘è¡¨å–®æäº¤è™•ç†
        document.getElementById('leaveForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const applicationDate = document.getElementById('applicationDate').value;
            const startDate = document.getElementById('leaveStartDate').value;
            const startTime = document.getElementById('leaveStartTime').value;
            const endDate = document.getElementById('leaveEndDate').value;
            const endTime = document.getElementById('leaveEndTime').value;
            const reason = document.getElementById('reason').value;
            const notes = document.getElementById('notes').value;

            // é©—è­‰æ—¥æœŸé‚è¼¯
            const start = new Date(`${startDate}T${startTime}`);
            const end = new Date(`${endDate}T${endTime}`);
            
            if (end <= start) {
                alert('çµæŸæ™‚é–“å¿…é ˆæ™šæ–¼é–‹å§‹æ™‚é–“ï¼');
                return;
            }

            const hours = calculateLeaveHours(startDate, startTime, endDate, endTime);
            const days = calculateLeaveDays(hours);

            // æª¢æŸ¥æ˜¯å¦è¶…éå‰©é¤˜ç‰¹ä¼‘ï¼ˆä¿®æ”¹æ™‚è¦æ’é™¤åŸæœ¬çš„ç´€éŒ„ï¼‰
            let totalUsedDays = leaveRecords.reduce((sum, record) => {
                if (editingRecordId && record.id === editingRecordId) {
                    return sum; // ä¿®æ”¹æ™‚æ’é™¤åŸæœ¬çš„ç´€éŒ„
                }
                return sum + record.days;
            }, 0);
            
            if (totalUsedDays + days > 10) {
                alert(`ç”³è«‹å¤©æ•¸è¶…éå‰©é¤˜ç‰¹ä¼‘ï¼å‰©é¤˜å¤©æ•¸ï¼š${10 - totalUsedDays} å¤©`);
                return;
            }

            if (editingRecordId) {
                // ä¿®æ”¹ç¾æœ‰ç´€éŒ„
                const recordIndex = leaveRecords.findIndex(r => r.id === editingRecordId);
                if (recordIndex !== -1) {
                    leaveRecords[recordIndex] = {
                        id: editingRecordId,
                        applicationDate,
                        startDate,
                        startTime,
                        endDate,
                        endTime,
                        hours: hours,
                        days: days,
                        reason,
                        notes
                    };
                }
                
                // å„²å­˜åˆ° localStorage
                localStorage.setItem('leaveRecords', JSON.stringify(leaveRecords));
                
                alert('ç‰¹ä¼‘ç”³è«‹å·²æˆåŠŸæ›´æ–°ï¼');
                cancelEdit(); // é‡ç½®è¡¨å–®ç‹€æ…‹
            } else {
                // æ–°å¢ç´€éŒ„
                const newRecord = {
                    id: recordIdCounter++,
                    applicationDate,
                    startDate,
                    startTime,
                    endDate,
                    endTime,
                    hours: hours,
                    days: days,
                    reason,
                    notes
                };

                leaveRecords.push(newRecord);
                
                // å„²å­˜åˆ° localStorage
                localStorage.setItem('leaveRecords', JSON.stringify(leaveRecords));
                
                // é‡ç½®è¡¨å–®
                document.getElementById('leaveForm').reset();
                document.getElementById('applicationDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('leaveStartTime').value = '09:00';
                document.getElementById('leaveEndTime').value = '18:00';

                alert('ç‰¹ä¼‘ç”³è«‹å·²æˆåŠŸæ–°å¢ï¼');
            }

            // æ›´æ–°é¡¯ç¤º
            renderRecords();
            updateStatistics();
        });

        // åœ‹å®šå‡æ—¥è¡¨å–®æäº¤è™•ç†
        document.getElementById('holidayForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('holidayName').value;
            const date = document.getElementById('holidayDate').value;

            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ—¥æœŸçš„å‡æ—¥
            const existingHoliday = holidays.find(h => h.date === date);
            if (existingHoliday) {
                alert('è©²æ—¥æœŸå·²å­˜åœ¨åœ‹å®šå‡æ—¥ï¼');
                return;
            }

            // æ–°å¢åœ‹å®šå‡æ—¥
            holidays.push({
                id: holidayIdCounter++,
                name: name,
                date: date
            });

            // å„²å­˜åˆ° localStorage
            localStorage.setItem('holidays', JSON.stringify(holidays));

            // é‡ç½®è¡¨å–®
            document.getElementById('holidayForm').reset();
            
            // æ›´æ–°é¡¯ç¤º
            updateWorkingDaysCalculation();
            
            alert('åœ‹å®šå‡æ—¥å·²æˆåŠŸæ–°å¢ï¼');
        });

        // åˆå§‹åŒ–
        renderRecords();
        updateStatistics();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97aec75672d4f1dc',t:'MTc1NzE3MDIyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
